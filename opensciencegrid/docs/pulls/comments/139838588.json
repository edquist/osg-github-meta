{
  "_links": {
    "html": {
      "href": "https://github.com/opensciencegrid/docs/pull/177#discussion_r139838588"
    }, 
    "pull_request": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/177"
    }, 
    "self": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/139838588"
    }
  }, 
  "author_association": "OWNER", 
  "body": "Don't need the unicode `\u2026` here and below", 
  "commit_id": "4a4ed22fda9d855c25ca9e7918a7b800ba736a56", 
  "created_at": "2017-09-19T22:54:04Z", 
  "diff_hunk": "@@ -0,0 +1,762 @@\n+Writing Routes For HTCondor-CE\n+==============================\n+\n+The [JobRouter](http://research.cs.wisc.edu/htcondor/manual/v8.6/5_4HTCondor_Job.html) is at the heart of HTCondor-CE and allows admins to transform and direct jobs to specific batch systems. Customizations are made in the form of job routes where each route corresponds to a separate job transformation: If an incoming job matches a job route's requirements, the route creates a transformed job (referred to as the 'routed job') that is then submitted to the batch system. The CE package comes with default routes located in `/etc/condor-ce/config.d/02-ce-*.conf` that provide enough basic functionality for a small site.\n+\n+If you have needs beyond delegating all incoming jobs to your batch system as they are, this document provides examples of common job routes and job route problems.\n+\n+Quirks and Pitfalls\n+-------------------\n+\n+-   The JobRouter matches jobs to routes in a round-robin fashion (for HTCondor versions < 8.7.1). This means that if a job can match to multiple routes, it can be routed by any of them! So when writing job routes, make sure that they are exclusive to each other and that your jobs can only match to a single route.\n+-   If a value is set in [JOB\\_ROUTER\\_DEFAULTS](#job59router59defaults) with `eval_set_<variable>`, override it by using `eval_set_<variable>` in the `JOB_ROUTER_ENTRIES`. Do this at your own risk as it may cause the CE to break.\n+-   Make sure to run `condor_ce_reconfig` after changing your routes, otherwise they will not take effect.\n+-   Before the last square bracket, make sure all lines end in a line continuation character (backslash). You can inspect the syntax of your routes with `condor_ce_config_val JOB_ROUTER_ENTRIES` to see if HTCondor-CE has ingested them properly.\n+-   Do **not** set the job environment through the JobRouter. Instead, add any changes to the `[Local Settings]` section in `/etc/osg/config.d/40-localsettings.ini` and run osg-configure, as documented [here](../other/configuration-with-osg-configure).\n+-   HTCondor batch system only: Local universe jobs are excluded from any routing.\n+\n+How Job Routes are Constructed\n+------------------------------\n+\n+Each job route\u2019s [ClassAd](http://research.cs.wisc.edu/htcondor/manual/v8.6/4_1HTCondor_s_ClassAd.html) is constructed by combining each entry from the `JOB_ROUTER_ENTRIES` with the `JOB_ROUTER_DEFAULTS`. Attributes that are [set_](#setting-attributes) in `JOB_ROUTER_ENTRIES` will override those [set_](#setting-attributes) in `JOB_ROUTER_DEFAULTS`\n+\n+### JOB\\_ROUTER\\_ENTRIES\n+\n+`JOB_ROUTER_ENTRIES` is a configuration variable whose default is set in `/etc/condor-ce/config.d/02-ce-*.conf` but may be overriden by the administrator in `/etc/condor-ce/config.d/99-local.conf`. This document outlines the many changes you can make to `JOB_ROUTER_ENTRIES` to fit your site\u2019s needs.\n+\n+### JOB\\_ROUTER\\_DEFAULTS\n+\n+`JOB_ROUTER_DEFAULTS` is a python-generated configuration variable that sets default job route values that are required for the HTCondor-CE's functionality. To view its contents, run the following command:\n+\n+``` console\n+user@host $ condor_ce_config_val JOB_ROUTER_DEFAULTS | sed 's/;/;\\n/g'\n+```\n+\n+!!! warning\n+    If a value is set in [JOB\\_ROUTER\\_DEFAULTS](#job59router59defaults) with `eval_set_<variable>`, override it by using `eval_set_<variable>` in the `JOB_ROUTER_ENTRIES`. Do this at your own risk as it may cause the CE to break.\n+\n+!!! warning\n+    Do **not** set the `JOB_ROUTER_DEFAULTS` configuration variable yourself. This will cause the CE to stop functioning.\n+\n+Generic Routes\n+--------------\n+\n+This section contains general information about job routes that can be used regardless of the type of batch system at your site. New routes should be placed in `/etc/condor-ce/config.d/99-local.conf`, not the original `02-ce-*.conf`.\n+\n+### Required fields\n+\n+The minimum requirements for a route are that you specify the type of batch system that jobs should be routed to and a name for each route. Default routes can be found in `/usr/share/condor-ce/config.d/02-ce-<batch system>-defaults.conf`, provided by the `osg-ce-<batch system>` packages.\n+\n+#### Batch system\n+\n+Each route needs to indicate the type of batch system that jobs should be routed to. For HTCondor batch systems, the `TargetUniverse` attribute needs to be set to `5` or `\"vanilla\"`. For all other batch systems, the `TargetUniverse` attribute needs to be set to `9` or `\"grid\"` and the `GridResource` attribute needs to be set to `\"batch <batch system>\"` (where `<batch system>` can be one of `pbs` (for both users of `pbs` and `SLURM`), `lsf`, or `sge`).\n+\n+```\n+JOB_ROUTER_ENTRIES = [ \\\n+     %RED%TargetUniverse = 5; \\%ENDCOLOR%\n+     name = \"Route jobs to HTCondor\"; \\\n+] \\\n+[ \\\n+     %RED%GridResource = \"batch pbs\"; \\%ENDCOLOR%\n+     %RED%TargetUniverse = 9; \\%ENDCOLOR%\n+     name = \"Route jobs to PBS\"; \\\n+]\n+```\n+\n+#### Route name\n+\n+To identify routes, you will need to assign a name to the route with the `name` attribute:\n+\n+```\n+JOB_ROUTER_ENTRIES = [ \\\n+     TargetUniverse = 5; \\\n+     %RED%name = \"Route jobs to HTCondor\"; \\%ENDCOLOR%\n+]\n+```\n+\n+The name of the route will be useful in debugging since it shows up in the output of [condor\\_ce\\_job\\_router\\_info](troubleshoot-htcondor-ce#condor95ce95job95router95info), the [JobRouterLog](troubleshoot-htcondor-ce#jobrouterlog), and in the ClassAd of the routed job, which can be viewed with [condor\\_ce\\_q](troubleshoot-htcondor-ce#condor95ce95q) or [condor\\_ce\\_history](troubleshoot-htcondor-ce#condor95ce95history).\n+\n+### Writing multiple routes\n+\n+If your batch system needs incoming jobs to be sorted (e.g. if different VO's need to go to separate queues), you will need to write multiple job routes. Each route is enclosed by square brackets and unless they're the last closing bracket, they need to be followed by the line continuation character. The following routes takes incoming jobs that have a `queue` attribute set to `\"analy\"` and routes them to the site's HTCondor batch system. Any other jobs will be sent to that site's PBS batch system.\n+\n+!!! note\n+    For versions of HTCondor < 8.7.1, the JobRouter matches jobs to routes in a round-robin fashion. This means that if a job can match to multiple routes, it can be routed by any of them! So when writing job routes, make sure that they are exclusive to each other and that your jobs can only match to a single route.\n+\n+```\n+JOB_ROUTER_ENTRIES = %RED%[ \\%ENDCOLOR%\n+     TargetUniverse = 5; \\\n+     name = \"Route jobs to HTCondor\"; \\\n+     Requirements = (TARGET.queue =?= \"analy\"); \\\n+%RED%] \\\n+[ \\%ENDCOLOR%\n+     GridResource = \"batch pbs\"; \\\n+     TargetUniverse = 9; \\\n+     name = \"Route jobs to PBS\"; \\\n+     Requirements = (TARGET.queue =!= \"analy\"); \\\n+%RED%]%ENDCOLOR%\n+```\n+\n+### Writing comments\n+\n+To write comments you can use C-style comments, text enclosed by `/* */`. If the comment is at the end of a line, it still has to be followed by the line continuation character.\n+\n+```\n+JOB_ROUTER_ENTRIES = [ \\\n+     TargetUniverse = 5; \\\n+     name = \"C-style comments\"; \\\n+     %RED%/* This is a comment */ \\%ENDCOLOR%\n+]\n+```\n+\n+You can also use `#` to comment out single lines:\n+\n+```\n+JOB_ROUTER_ENTRIES = [ \\\n+     TargetUniverse = 5; \\\n+     name = \"Hash comments\"; \\\n+     %RED%# BrokenAttribute = \"commented out\"; \\%ENDCOLOR%\n+]\n+```\n+\n+### Setting attributes for all routes\n+\n+To set an attribute that will be applied to all routes, you will need to ensure that `MERGE_JOB_ROUTER_DEFAULT_ADS` is set to `True` (check the value with [condor\\_ce\\_config\\_val](troubleshoot-htcondor-ce#condor95ce95config95val)) and use the `[set_](#setting-attributes)` function in the `JOB_ROUTER_DEFAULTS`. The following configuration sets the `Periodic_Hold` attribute for all routes:\n+\n+```\n+# Use the defaults generated by the condor_ce_router_defaults script.  To add\n+# additional defaults, add additional lines of the form:\n+#\n+#   JOB_ROUTER_DEFAULTS = $(JOB_ROUTER_DEFAULTS) [set_foo = 1;]\n+#\n+MERGE_JOB_ROUTER_DEFAULT_ADS=True\n+JOB_ROUTER_DEFAULTS = $(JOB_ROUTER_DEFAULTS) %RED%[set_Periodic_Hold = (NumJobStarts >= 1 && JobStatus == 1) || NumJobStarts > 1;]%ENDCOLOR%\n+```\n+\n+### Filtering jobs based on\u2026", 
  "html_url": "https://github.com/opensciencegrid/docs/pull/177#discussion_r139838588", 
  "id": 139838588, 
  "original_commit_id": "ac978ed6174bc950889cb298da6f088ecee66615", 
  "original_position": 136, 
  "path": "docs/compute-element/job-router-recipes.md", 
  "position": 136, 
  "pull_request_review_id": 63826805, 
  "pull_request_url": "https://api.github.com/repos/opensciencegrid/docs/pulls/177", 
  "updated_at": "2017-09-28T00:14:43Z", 
  "url": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/139838588", 
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5246893?v=4", 
    "events_url": "https://api.github.com/users/matyasselmeci/events{/privacy}", 
    "followers_url": "https://api.github.com/users/matyasselmeci/followers", 
    "following_url": "https://api.github.com/users/matyasselmeci/following{/other_user}", 
    "gists_url": "https://api.github.com/users/matyasselmeci/gists{/gist_id}", 
    "gravatar_id": "", 
    "html_url": "https://github.com/matyasselmeci", 
    "id": 5246893, 
    "login": "matyasselmeci", 
    "organizations_url": "https://api.github.com/users/matyasselmeci/orgs", 
    "received_events_url": "https://api.github.com/users/matyasselmeci/received_events", 
    "repos_url": "https://api.github.com/users/matyasselmeci/repos", 
    "site_admin": false, 
    "starred_url": "https://api.github.com/users/matyasselmeci/starred{/owner}{/repo}", 
    "subscriptions_url": "https://api.github.com/users/matyasselmeci/subscriptions", 
    "type": "User", 
    "url": "https://api.github.com/users/matyasselmeci"
  }
}
