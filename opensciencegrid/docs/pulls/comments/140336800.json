{
  "_links": {
    "html": {
      "href": "https://github.com/opensciencegrid/docs/pull/179#discussion_r140336800"
    }, 
    "pull_request": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/179"
    }, 
    "self": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/140336800"
    }
  }, 
  "author_association": "OWNER", 
  "body": "I don't really think any of this works anymore.  I would remove the whole section unless we see some motivation to add it back.", 
  "commit_id": "a19bdb21d4bf7ab2440f88f9be1943d493a22751", 
  "created_at": "2017-09-21T19:24:58Z", 
  "diff_hunk": "@@ -0,0 +1,264 @@\n+Install Bestman Xrootd SE\n+=========================\n+\n+About this Document\n+===================\n+\n+This page explains how to install the BeStMan Storage Element with underlying XRootD storage.\n+\n+!!! note\n+    Starting on 11 February 2014, all OSG-issued Digicert certificates (host, service, and personal) use the SHA-2 algorithm. %RED%The BeStMan software must be on a recent version to support SHA-2 certificates%ENDCOLOR%. Please visit [our SHA-2 compliance page](https://opensciencegrid.github.io/technology/projects/sha2-support/) for more information about minimum required versions of software components.\n+\n+Requirements\n+============\n+\n+Host and OS\n+-----------\n+\n+-   OS is Red Hat Enterprise Linux 6, 7, and variants (see [details...](../common/yum.md))\n+-   [EPEL](http://fedoraproject.org/wiki/EPEL) repos enabled.\n+-   A working XRootD Server. See [InstallXrootd](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallXrootd) for details.\n+-   Root access\n+\n+Users\n+-----\n+\n+This installation will create several users unless they are already created.\n+\n+| User      | Comment                                                 |\n+|:----------|:--------------------------------------------------------|\n+| `bestman` | Used by Bestman SRM server (needs sudo access).         |\n+| `daemon`  | Used by globus-gridftp-server.                          |\n+| `xrootd`  | Used by the xrootd client to contact xrootd redirector. |\n+\n+For this package to function correctly, you will have to create the users needed for grid operation. Any user that can be authenticated should be created.\n+\n+For grid-mapfile users, each line of the grid-mapfile is a certificate/user pair. Each user in this file should be created on the server.\n+\n+For gums users, this means that each user that can be authenticated by gums should be created on the server.\n+\n+Note that these users must be kept in sync with the authentication method. For instance, if new users or rules are added in gums, then new users should also be added here.\n+\n+Certificates\n+------------\n+\n+| Certificate                 | User that owns certificate | Path to certificate                                                                                 |\n+|:----------------------------|:---------------------------|:----------------------------------------------------------------------------------------------------|\n+| Host certificate            | `root`                     | `/etc/grid-security/hostcert.pem` `/etc/grid-security/hostkey.pem`                       |\n+| Bestman service certificate | `bestman`                  | `/etc/grid-security/bestman/bestmancert.pem` `/etc/grid-security/bestman/bestmankey.pem` |\n+\n+[Instructions](../common/pki-cli.md) to request a service certificate.\n+\n+You will also need a copy of CA certificates (see below).\n+\n+Networking\n+----------\n+\n+| Service Name            | Protocol    | Port Number                      | Inbound | Outbound |Commen                     |\n+|:------------------------|:------------|:---------------------------------|:--------|:---------|:--------------------------|\n+| GridFTP                 | tcp         |2811 and `GLOBUS_TCP_SOURCE_RANGE`| YES     |          | contiguous range of ports |\n+| Storage Resource Manager| tcp         | 8080                             | YES     |          |                           |\n+| Storage Resource Manager| tcp\t\t|  8443                            | YES     |          |                           |\n+\n+\n+Install Instructions\n+=-===================\n+\n+Note that this package is primarily intended for Bestman-Gateway acting as an endpoint for XRootD server. If you have not installed an XRootD server yet, follow the instructions in [InstallXrootd](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallXrootd).\n+\n+\n+\n+Certificates\n+------------\n+\n+GridFTP, which is a part of this meta-package, requires a certificate package to run. If you require a specific certificate package, follow the [InstallCertAuth](../common/ca.md) instructions to install it. If you do not install a grid certificate package first, the install procedure will install one for you as part of its dependencies. (usually osg-ca-certs).\n+\n+Package installation instructions\n+---------------------------------\n+\n+1.  Install Java using [these instructions](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallSoftwareWithOpenJDK7#InstallingJava)\n+2.  Install the BeStMan Gateway XRootD Storage element meta-package:\n+\n+        :::console\n+        root@host # yum install osg-se-bestman-xrootd\n+\n+Configuring GridFTP authentication\n+----------------------------------\n+\n+For information on how to configure authentication for your GridFTP installation, please refer to the [configuring authentication section of the GridFTP guide](../data/gridftp/#configuring-gridftp).\n+\n+Configuring GridFTP XRootD support\n+----------------------------------\n+\n+ In order to configure GridFTP to work with XRootD, you will need to configure the Data Storage Interface (DSI) module with Xrootd pre-load libraries. This module is used to access Xrootd and POSIX file systems.\n+\n+Edit `/etc/sysconfig/xrootd-dsi` (create it if it is missing) and set XROOTD\\_VMP (XRootD Virtual Mount Point) to use your Xrootd redirector.\n+\n+    :::file\n+    export XROOTD_VMP=\"%RED%redirector:1094:/local_path=/remote_path%ENDCOLOR%\"\n+\n+!!! note\n+    The syntax of the above environment variable is a little confusing, so make sure that you adhere to the following directions for XROOTD_VMP (Virtual Mount Point):\n+\n+        - Redirector: This is the hostname and domain of the local XRootD redirector server.\n+        - local_path: This is the path used to access the GridFTP server (ie this server).\n+        - remote_path: This is the path used to access the XRootD redirector.\n+\n+!!! note\n+    The xrootd-dsi module overloads the `gridftp.conf` file and uses the alternate file `/etc/xrootd-dsi/gridftp-xrootd.conf`. If you have made local changes to your `gridftp.conf` file, then you will need to carry them over to `/etc/xrootd-dsi/gridftp-xrootd.conf`.\n+\n+Configuring xrootdfs\n+--------------------\n+\n+Though the DSI module will work for GridFTP, you will need a FUSE mount in order for BeStMan to work correctly with XRootD. Configure it using the following steps.\n+\n+Modify **`/etc/fstab`** by adding the following entries:\n+\n+    :::file\n+    ....\n+    xrootdfs                %RED%/mnt/xrootd%ENDCOLOR%              fuse    rdr=xroot://%RED%redirector1.domain.com%ENDCOLOR%:1094/%RED%/path/%ENDCOLOR%,uid=xrootd 0 0\n+\n+\n+Replace `/mnt/xrootd` with the path that you would like to access with BeStMan. This should also match the GridFTP settings for the `XROOTD_VMP` local path. Create **`/mnt/xrootd`** directory. Once you are finished, you can mount it:\n+\n+    :::file\n+    mount /mnt/xrootd\n+\n+You should now be able to run UNIX commands such as `ls /mnt/xrootd` to see the contents of the XRootD server.\n+\n+### (Optional) Configuring secured xrootdfs\n+\n+If you want to enable security for access to xrootd via xrootdfs you will need to modify xrootd configuration and perform several steps to make xrootdfs secured.\n+\n+1. On the xrootd redirector node, execute the following command:\n+\n+        :::console\n+        root@host # xrdsssadmin -k %RED%<my_key_name>%ENDCOLOR% -u anybody -g usrgroup add %RED%<keyfile>%ENDCOLOR%\n+\n+        eg:\n+\n+        root@host # xrdsssadmin -k top_secret -u anybody -g usrgroup add /etc/xrootd/xrootd.key\n+\n+2. Set ownership\n+\n+        :::console\n+        root@host # chown xrootd.xrootd /etc/xrootd/xrootd.key\n+\n+3. On the node where xrootdfs is installed modify **`/etc/fstab`** add security information:\n+\n+        :::console\n+        root@host # xrootdfs %RED%/mnt/xrootd %ENDCOLOR\" fuse rdr=xroot://%RED%redirector1.domain.com%ENDCOLOR%:1094/%RED%/path/redirector1%ENDCOLOR%,uid=xrootd,sss=%RED%keyfile%ENDCOLOR% 0 0\n+\n+4. On all xrootd data servers and redirector node, modify xrootd configuration (**`/etc/xrootd/xrootd-clustered.cfg`**) by adding the following segment: \n+\n+        :::file\n+        # ENABLE_SECURITY_BEGIN \n+           xrootd.seclib /usr/lib64/libXrdSec.so \n+           #the line below should be before \"sec.protocol ... unix\"\n+           %RED%sec.protocol /usr/lib64 sss -s keyfile %ENDCOLOR%\n+           sec.protocol /usr/lib64 unix \n+           # this specify that we use the 'unix' authentication module, additional one can be specified. \n+           # this is the authorization file\n+           acc.authdb /etc/xrootd/auth_file\n+           ofs.authorize \n+           # ENABLE_SECURITY_END\n+\n+5. On all xrootd data server nodes, edit /etc/xrootd/auth\\_file to add authorized users of the form `u %RED%username%ENDCOLOR% %RED%/directoryname%ENDCOLOR% lr` where \"lr\" is the permission set.\n+\n+6. Copy %RED%keyfile<span class=\"twiki-macro ENDCOLOR\"></span> from redirector node to every data server node and the xrootdfs node. Make sure that this file is owned by the `xrootd` user.\n+\n+7. Restart xrootd cluster by following [these instructions](https://twiki.grid.iu.edu/bin/view/SoftwareTeam/HowToInstallXrootd)\n+8. On xroodfs node execute mount:\n+\n+        :::console\n+        root@host # mount %RED%/mnt/xrootd%ENDCOLOR%\n+\n+9. Verify that you can access the mount point (df,ls) and can not write into unauthorized path, e.g:\n+\n+        :::console\n+        root@host # cp /bin/sh /mnt/xrootd/tlevshin/test1 cp: \n+        cannot create regular file \\`/mnt/xrootd/tlevshin/test1': Permission denied\n+\n+    Login as yourself and try:\n+ \n+        :::console\n+        root@host # su - tlevshin \n+        user@host $ cp /bin/sh /mnt/xrootd/tlevshin/test1\n+\n+Edit Bestman Settings\n+---------------------\n+\n+See [Edit Bestman Settings](../data/bestman-install/#edit-bestman-settings)\n+\n+Modify `/etc/sudoers`\n+---------------------\n+\n+See [Bestman Instructions](../data/bestman-install/#modify-etcsudoers)\n+\n+### (Optional) Copying certificates to a bestman location\n+\n+See [Bestman Instructions](../data/bestman-install/#copying-certificates-to-an-alternate-location)\n+\n+\n+Configure Xrootd Gratia Probes", 
  "html_url": "https://github.com/opensciencegrid/docs/pull/179#discussion_r140336800", 
  "id": 140336800, 
  "original_commit_id": "dd927fdc6f25b534cfd3fda72359529081515690", 
  "original_position": 203, 
  "path": "docs/data/install-bestman-xrootd.md", 
  "position": null, 
  "pull_request_review_id": 64395165, 
  "pull_request_url": "https://api.github.com/repos/opensciencegrid/docs/pulls/179", 
  "updated_at": "2017-09-28T15:04:18Z", 
  "url": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/140336800", 
  "user": {
    "avatar_url": "https://avatars2.githubusercontent.com/u/1093447?v=4", 
    "events_url": "https://api.github.com/users/bbockelm/events{/privacy}", 
    "followers_url": "https://api.github.com/users/bbockelm/followers", 
    "following_url": "https://api.github.com/users/bbockelm/following{/other_user}", 
    "gists_url": "https://api.github.com/users/bbockelm/gists{/gist_id}", 
    "gravatar_id": "", 
    "html_url": "https://github.com/bbockelm", 
    "id": 1093447, 
    "login": "bbockelm", 
    "organizations_url": "https://api.github.com/users/bbockelm/orgs", 
    "received_events_url": "https://api.github.com/users/bbockelm/received_events", 
    "repos_url": "https://api.github.com/users/bbockelm/repos", 
    "site_admin": false, 
    "starred_url": "https://api.github.com/users/bbockelm/starred{/owner}{/repo}", 
    "subscriptions_url": "https://api.github.com/users/bbockelm/subscriptions", 
    "type": "User", 
    "url": "https://api.github.com/users/bbockelm"
  }
}
