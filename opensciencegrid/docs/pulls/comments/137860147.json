{
  "_links": {
    "html": {
      "href": "https://github.com/opensciencegrid/docs/pull/38#discussion_r137860147"
    }, 
    "pull_request": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/38"
    }, 
    "self": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/137860147"
    }
  }, 
  "author_association": "OWNER", 
  "body": "change links to point to twiki since docs haven't been migrated yet", 
  "commit_id": "6409e2c14dd444a58ead34f2882c64be9e26b3dd", 
  "created_at": "2017-09-08T18:32:45Z", 
  "diff_hunk": "@@ -0,0 +1,334 @@\n+Installing, Configuring, Using, and Troubleshooting RSV\n+=======================================================\n+\n+About This Guide\n+----------------\n+\n+The Resource and Service Validation (RSV) software helps a site administrator verify that certain site resources and services are working as expected. OSG recommends that sites install and run RSV, but it is optional; further, each site selects which specific tests (called *probes*) to run.\n+\n+Use this page to learn more about RSV in general, and how to install, configure, run, test, and troubleshoot RSV from the OSG software repositories. For documentation on specific probes or on how to write your own probes, please check the [Reference section](#reference).\n+\n+Introduction to RSV\n+-------------------\n+\n+The Resource and Service Validation (RSV) software provides OSG site administrators a scalable and easy-to-maintain resource and service monitoring infrastructure. The components of RSV are:\n+\n+- **RSV Client.** The client tools allow a site administrator to run tests against their site by providing a set of tests (which can run on the same or other hosts within a site), HTCondor-Cron for scheduling, and tools for collecting and storing the results (using Gratia). The client package is not installed by default and may be installed on a CE or other host. Generally, you configure the RSV client to run tests at scheduled time intervals and then it makes results available on a local website. Also, the client can upload test results to a central collector (see next item).\n+- **RSV Collector/Server.** The central OSG RSV Collector accepts and stores results from RSV clients throughout OSG, which can be viewed in [MyOSG](http://myosg.grid.iu.edu/), on the \u201cCurrent RSV Status\u201d page and under the \u201cResource Group\u201d menu.\n+- **Periodic Availability Reports.** The availability of all active registered OSG resources and the services running on each of those resources is calculated using the results received for [critical metrics](https://twiki.grid.iu.edu/bin/view/Operations/RsvEquivalency#Critical_Tests_for_OSG_Resources>). Once a day, these availability numbers are [published online](http://rsv.grid.iu.edu/daily-reports) and via email [as explained here](https://twiki.grid.iu.edu/bin/view/Trash/Trash/Trash/Trash/MeasurementsAndMetrics/RsvReportsOverview>) (More information: [Outline of reports](https://twiki.grid.iu.edu/bin/view/Operations/RSVPeriodicReporting), [Installation guide for GOC staff](https://twiki.grid.iu.edu/bin/view/Trash/Trash/Trash/Trash/MeasurementsAndMetrics/RsvReports)).\n+- **RSV-SAM Transport.** The WLCG RSV-SAM Transport infrastructure pushes out RSV results, for resources that are flagged to be part of the WLCG Interoperability agreement, from the GOC collector to WLCG's Service Availability Monitoring (SAM) system. More information on viewing these results is [available here](Operations.RsvSAMGridView).\n+- **MyOSG and OIM Links.** RSV picks up resource information, WLCG interoperability information, etc., from a MyOSG resource group summary listing, which is in turn based on the [OSG Information Management (OIM) (topology) system](https://oim.grid.iu.edu) (Requires registration). Resource [maintenance scheduled on OIM](https://twiki.grid.iu.edu/twiki/bin/view/Operations/OIMMaintTool) are forwarded to WLCG SAM, if applicable.\n+\n+\n+Before Starting\n+---------------\n+\n+Before starting the installation process, consider the following points (consulting [the Reference section below](#reference) as needed):\n+\n+- **User IDs:** If they do not exist already, the installation will create the Linux user IDs `rsv` and `cndrcron`\n+- **Service certificate:** The RSV service requires a service certificate (`/etc/grid-security/rsv/rsvcert.pem`) and matching key (`/etc/grid-security/rsv/rsvkey.pem`)\n+- **Network ports:** To view results, port 80 must accept incoming requests; outbound connectivity to tested services must work, too\n+- **Host choice:** Install RSV on your site CE unless you have specific reasons (e.g., performance) for installing on a separate host\n+\n+As with all OSG software installations, there are some one-time (per host) steps to prepare in advance:\n+\n+- Ensure the RSV host has [a supported operating system](../common/yum.md)\n+- Obtain root access to the host\n+- Prepare [the required Yum repositories](../common/yum.md)\n+- Install [CA certificates](../security/ca-cert-auth.md)\n+\n+Installing RSV\n+--------------\n+\n+An installation of RSV at a site consists of the RSV client software, the Apache web server, parts of HTCondor (for its cron-like scheduling capabilities), and various other small tools. To simplify installation, OSG provides a convenience RPM that installs all required software with a single command.\n+\n+1. Consider updating your local cache of Yum repository data and your existing RPM packages:\n+\n+        :::console\n+        [root@client ~] # yum clean all --enablerepo=\\*\n+        [root@client ~] # yum update\n+\n+    !!! note\n+        The `update` command will update **all** packages on your system.\n+\n+2. If you have installed HTCondor already but not by RPM, install a special empty RPM to make RSV happy:\n+\n+        :::console   \n+        [root@client ~] # yum install empty-condor --enablerepo=osg-empty\n+\n+3. Install RSV and related software: \n+\n+        :::console\n+        [root@client ~] # yum install rsv  \n+   \n+Configuring RSV\n+---------------\n+ \n+After installation, there are some one-time configuration steps to tell RSV how to operate at your site.\n+ \n+1. Edit `/etc/osg/config.d/30-rsv.ini` and follow the instructions in the file. There are detailed comments for each setting. In the simplest case \u2014 to monitor only your CE \u2014 set the `htcondor_ce_hosts` variable (or `gram_ce_hosts` for a GRAM CE) to the fully qualified hostname of your CE. For a sample `rsv.ini` file, see the complete installation output [below](#InstallDetails)\n+\n+2. If you have installed HTCondor already but not by RPM, specify the location of the Condor installation in `30-rsv.ini` in the `condor_location` setting. If an HTCondor RPM is installed, you do not need to set `condor_location`.\n+\n+3. Complete the configuration using the `osg-configure` tool:\n+\n+        :::console\n+        [root@client ~] # osg-configure -v\n+        [root@client ~] # osg-configure -c\n+\n+    !!! note\n+        The `osg-configure` tool produces a lot of output; see [below](#OsgConfigDetails) for an example.\n+\n+### Optional configuration\n+\n+The following configuration steps are optional and will likely not be required for setting up a small or typical site. If you do not need any of the following special configurations, skip to [the section on using RSV](#using-rsv).\n+\n+Generally speaking, read the ConfigureRsv page for more advanced configuration options. Or see [below](#ConfigFileDetails) for specific advanced configuration scenarios.\n+\n+#### Configuring RSV to run probes using a remote server\n+\n+RSV monitors systems by running probes, which can run on the RSV host itself (the default case), via a separate batch system like HTCondor, or via a remote batch system using a Globus gatekeeper and its job manager. The last two options both can count those jobs and report them to, for example, Gratia.\n+\n+In this case, remember to:\n+\n+- Add the RSV user `rsv` on all the systems where the probes may run, and\n+- Map the RSV service certificate to the user you intend to use for RSV. This should be a local user used exclusively for RSV and not belonging to an institutional VO to avoid for the RSV probes to be accounted as regular VO jobs in Gratia. This can be done in [GUMS](../security/gums.md) or [using a grid-mapfile-local](../security/Edg-mkgridmap.md) (if you use a grid-mapfile). MapServiceCertToRsvUser explains how to configure GUMS or the grid-mapfile. Also see the [CE installation document](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/NavAdminCompute) for more information.\n+\n+#### Configuring the RSV web server to use HTTPS instead of HTTP\n+\n+If you would like your local RSV web server to use HTTPS instead of the default HTTP (for compatibility or security reasons), complete the steps below. This procedure assumes that you already have an HTTP service certificate (or a copy of the host certificate) in `/etc/grid-security/http/`. If not, omit the `SSLCertificate*` modifications below, and your web server will start with its own, self-signed certificate.\n+\n+1. Install `mod_ssl`:\n+\n+        :::console\n+        [root@client ~] # yum install mod_ssl\n+\n+2. Make an alternate set of HTTP service certificate files:\n+\n+        :::console\n+        [root@client ~] # cp -p /etc/grid-security/http/httpcert.pem /etc/grid-security/http/httpcert2.pem\n+        [root@client ~] # cp -p /etc/grid-security/http/httpkey.pem /etc/grid-security/http/httpkey2.pem\n+        [root@client ~] # chown apache:apache /etc/grid-security/http/http*2.pem\n+\n+3. Back up existing Apache configuration files:\n+\n+        :::console\n+        [root@client ~] # cp -p /etc/httpd/conf/httpd.conf /etc/httpd/conf/httpd.conf.orig\n+        [root@client ~] # cp -p /etc/httpd/conf.d/ssl.conf /etc/httpd/conf.d/ssl.conf.orig\n+\n+4. Change the default port for HTTP connections to 8000 by editing `/etc/httpd/conf/httpd.conf`\n+\n+        :::file\n+        Listen 8000\n+        \n+\n+5. Set up HTTPS access by editing `/etc/httpd/conf.d/ssl.conf`:\n+\n+        :::file\n+        Listen 8443\n+        <VirtualHost _default_:8443>\n+        SSLCertificateFile /etc/grid-security/http/httpcert2.pem\t\n+        SSLCertificateKeyFile /etc/grid-security/http/httpkey2.pem\n+\n+    After these changes, when you start the Apache service, it will listening on ports `8000` (for HTTP) and `8443` (for HTTPS), rather than the default port `80` (for HTTP only).\n+\n+    !!! warning\n+        if you make the changes above, you must restart the Apache server after each CA certificate update to pick up the changes.\n+\n+\n+Using RSV\n+---------\n+\n+### Managing RSV and associated services\n+\n+In addition to the RSV service itself, there are a number of supporting services in your installation. The specific services are:\n+\n+| Software      | Service name                                   | Notes                   |\n+|:--------------|:-----------------------------------------------|------------------------ |\n+| Fetch CRL     | On EL 6: `fetch-crl-boot` and `fetch-crl-cron` | See (CA documentation)[]|\n+| Apache        | httpd                                          |                         |\n+| HTCondor-Cron | condor-cron                                    |                         |\n+| RSV           | rsv                                            |                         |\n+\n+Start the services in the order listed and stop them in reverse order. As a reminder, here are common service commands (all run as `root`):\n+\n+\n+| To \u2026                                        | Run the command \u2026                     |\n+|:--------------------------------------------|:--------------------------------------|\n+| Start a service                             | `service %RED%<SERVICE-NAME>%ENDCOLOR% start` |\n+| Stop a service                              | `service %RED%<SERVICE-NAME>%ENDCOLOR% stop`  |\n+| Enable a service to start during boot       | `chkconfig %RED%<SERVICE-NAME>%ENDCOLOR% on`  |\n+| Disable a service from starting during boot | `chkconfig %RED%<SERVICE-NAME>%ENDCOLOR% off` |\n+\n+### Running RSV manually\n+\n+Normally, the HTCondor-Cron scheduler runs RSV periodically. However, you can run RSV probes manually at any time:\n+\n+``` rootscreen\n+%UCL_PROMPT_ROOT% rsv-control --run --all-enabled\n+```\n+\n+If successful, results will be available from your local RSV web server (e.g., <http://localhost/rsv>) and, if enabled (which is the default) on [MyOSG](http://myosg.grid.iu.edu/).\n+\n+You can also run the metrics individually or pass special parameters as explained in the [rsv-control document](../monitoring/rsv-control.md).\n+\n+Troubleshooting RSV\n+-------------------\n+\n+You can find more information on troubleshooting RSV in the [rsv-control documentation](RsvControl) and in [TroubleshootRSV](TroubleshootRsv).", 
  "html_url": "https://github.com/opensciencegrid/docs/pull/38#discussion_r137860147", 
  "id": 137860147, 
  "original_commit_id": "e603e1a13714c769ca0f713f9bf52497b53303f3", 
  "original_position": 178, 
  "path": "docs/monitoring/rsv.md", 
  "position": null, 
  "pull_request_review_id": 61582103, 
  "pull_request_url": "https://api.github.com/repos/opensciencegrid/docs/pulls/38", 
  "updated_at": "2017-09-08T21:02:15Z", 
  "url": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/137860147", 
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5246893?v=4", 
    "events_url": "https://api.github.com/users/matyasselmeci/events{/privacy}", 
    "followers_url": "https://api.github.com/users/matyasselmeci/followers", 
    "following_url": "https://api.github.com/users/matyasselmeci/following{/other_user}", 
    "gists_url": "https://api.github.com/users/matyasselmeci/gists{/gist_id}", 
    "gravatar_id": "", 
    "html_url": "https://github.com/matyasselmeci", 
    "id": 5246893, 
    "login": "matyasselmeci", 
    "organizations_url": "https://api.github.com/users/matyasselmeci/orgs", 
    "received_events_url": "https://api.github.com/users/matyasselmeci/received_events", 
    "repos_url": "https://api.github.com/users/matyasselmeci/repos", 
    "site_admin": false, 
    "starred_url": "https://api.github.com/users/matyasselmeci/starred{/owner}{/repo}", 
    "subscriptions_url": "https://api.github.com/users/matyasselmeci/subscriptions", 
    "type": "User", 
    "url": "https://api.github.com/users/matyasselmeci"
  }
}
