{
  "_links": {
    "html": {
      "href": "https://github.com/opensciencegrid/docs/pull/24#discussion_r134534747"
    }, 
    "pull_request": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/24"
    }, 
    "self": {
      "href": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/134534747"
    }
  }, 
  "author_association": "OWNER", 
  "body": "Didn't know that. Well, I checked it out and it works for me too here, but it still doesn't in the technology docs.", 
  "commit_id": "8b3c75adc39752e8f22eba44202b6057edd58c7d", 
  "created_at": "2017-08-22T16:33:20Z", 
  "diff_hunk": "@@ -1,168 +1,123 @@\n-Install a GridFTP Server\n-========================\n+Installing and Maintaining a GridFTP Server\n+===========================================\n \n-<span class=\"twiki-macro DOC_STATUS_TABLE\"></span> <span class=\"twiki-macro TOC\"></span>\n+About This Guide\n+----------------\n \n-\u2014\\# About this Document This page explains how to install the stand-alone Globus GridFTP server.\n+This page explains how to install the stand-alone Globus GridFTP server.\n \n The GridFTP package contains components necessary to set up a stand-alone gsiftp server and tools used to monitor and report its performance. A stand-alone GridFTP server might be used under the following circumstances:\n \n--   A simple front-end to a filesystem allowing access over WAN - for example NFS.\n--   BeStMan is capable of distributing its workload among several gsiftp servers so if you expect large movements of data into/out of your site, multiple gsiftp servers can be set up.\n-\n-\u2014\\# Requirements\n-\n-\u2014\\#\\# Host and OS\n-\n--   OS must be <span class=\"twiki-macro SUPPORTED_OS\"></span>.\n--   [EPEL](http://fedoraproject.org/wiki/EPEL) repos enabled.\n--   Root access\n-\n-\u2014\\#\\# Certificates\n-\n-<span class=\"twiki-macro STARTSECTION\">Certificates</span>\n-\n-| Certificate      | User that owns certificate | Path to certificate                                                       |\n-|:-----------------|:---------------------------|:--------------------------------------------------------------------------|\n-| Host certificate | `root`                     | `/etc/grid-security/hostcert.pem` \\<br\\> `/etc/grid-security/hostkey.pem` |\n-\n-<span class=\"twiki-macro ENDSECTION\">Certificates</span>\n-\n-[Instructions](InstallCertScripts) to request a service certificate.\n-\n-You will also need a copy of CA certificates (see below).\n-\n-\u2014\\#\\# Users\n-\n-<span class=\"twiki-macro STARTSECTION\">GridUsers</span> For this package to function correctly, you will have to create the users needed for grid operation. Any user that can be authenticated should be created.\n-\n-For grid-mapfile users, each line of the grid-mapfile is a certificate/user pair. Each user in this file should be created on the server.\n-\n-For gums users, this means that each user that can be authenticated by gums should be created on the server.\n-\n-Note that these users must be kept in sync with the authentication method. For instance, if new users or rules are added in gums, then new users should also be added here. <span class=\"twiki-macro ENDSECTION\">GridUsers</span>\n-\n-\u2014\\#\\# Networking\n-\n-<span class=\"twiki-macro STARTSECTION\">Firewalls</span> <span class=\"twiki-macro INCLUDE\" section=\"FirewallTable\" lines=\"gridftp,portrange,portsource\">Documentation/Release3.FirewallInformation</span> \\\\ <span class=\"twiki-macro ENDSECTION\">Firewalls</span>\n-\n-If you have a multi-homed host you may be interested in reading [this section](#ConfigMultiHomed).\n-\n-\u2014\\#\\# Engineering Considerations\n-\n-It is recommended that the GridFTP package be installed on its own server if:\n-\n--   You are serving the VOs that use storage heavily (CMS, ATLAS, CDF, and D0) and have more than 250 cores\n+-   You are serving VOs that use storage heavily (CMS, ATLAS, CDF, and D0) and your site has more than 250 cores\n -   Your site will be managing more than 50 TB of disk space\n+-   A simple front-end to a filesystem allowing access over WAN - for example NFS.\n \n-If you are planning to have a Storage Element with BeStMan and have more than 1Gbps bandwidth, then you should plan on at least one GridFTP server per 4Gbps of available bandwidth (assuming you have 10Gbps interfaces on the server) if you want to maximize throughput.\n-\n-Also, you have to decide what authorization mechanism you prefer. You may use either grid-mapfile or a GUMS server for users\u2019 authentication and authorization. We currently recommend using GUMS as it provides superior flexibility and allows a site to manage all of its mappings in one central location; most large sites use GUMS.\n-\n-<span class=\"twiki-macro NOTE\"></span> OSG does not support launching the GridFTP server with xinetd \u2014 only launching with init is supported.\n+!!! note\n+    This document is for a standalone GridFTP server on top of POSIX storage.  [See this page](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallHadoop200SE) for installation and configuration of a GridFTP server on top of the Hadoop Distributed File System.\n \n-\u2014\\# Install Instructions\n+Before Starting\n+---------------\n \n-<span class=\"twiki-macro INCLUDE\" section=\"OSGRepoBrief\" TOC_SHIFT=\"+\">YumRepositories</span> <span class=\"twiki-macro INCLUDE\" section=\"OSGBriefCaCerts\" TOC_SHIFT=\"+\">InstallCertAuth</span>\n+Before starting the installation process you will need to fulfill these prerequisites.\n \n-<span class=\"twiki-macro STARTSECTION\">Full</span>\n \n-<span class=\"twiki-macro STARTSECTION\">Install</span> GridFTP requires a certificate package to run. If you require a specific certificate package, follow the Documentation/Release3.InstallCertAuth instructions to install it. If you do not install a grid certificate package first, the install procedure will install one for you as part of its dependencies. (usually osg-ca-certs).\n+-   Ensure the host has [a supported operating system](../release/supported_platforms.md)\n+-   Obtain root access to the host\n+-   Prepare [the required Yum repositories](../common/yum.md)\n+-   Install [CA certificates](../common/ca.md)\n+-   Service certificate: The HTCondor-CE service uses a host certificate at `/etc/grid-security/hostcert.pem` and an accompanying key at `/etc/grid-security/hostkey.pem`\n+-   Network ports: GridFTP listens on TCP port 2811 and the list of ports configured by the `GLOBUS_TCP_SOURCE_RANGE` environment variable.\n \n-\u2014\\#\\# Installing the GridFTP Server\n+Installing GridFTP\n+------------------\n \n First, you will need to install the GridFTP meta-package:\n \n-``` rootscreen\n-%UCL_PROMPT_ROOT% yum install osg-gridftp\n+```console\n+[root@client ~] # yum install osg-gridftp\n ```\n \n-<span class=\"twiki-macro ENDSECTION\">Install</span>\n+Configuring GridFTP\n+-------------------\n \n-\u2014\\# Configuration\n+### Configuring authentication\n \n-\u2014\\#\\# Authorization\n+In OSG 3.3, there are three methods to manage authentication for incoming jobs: the [LCMAPS VOMS plugin](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallLcmapsVoms), [edg-mkgridmap](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/Edg-mkgridmap) and [GUMS](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallGums). Of these, GUMS has the most features and capabilities. The LCMAPS VOMS plugin is the new OSG-preferred authentication, offering the simplicity of edg-mkgridmap and many of GUMS' rich feature set. If you need to support \"[pool accounts](https://www.racf.bnl.gov/Facility/GUMS/1.4/use_configuration.html)\", GUMS is the only option with that capability.\n \n-<span class=\"twiki-macro STARTSECTION\">Authorization</span> There are two authorization options:\n+In OSG 3.4, the LCMAPS VOMS plugin is the only available authentication solution.\n \n--   Gridmap file\n--   GUMS authentication server\n+#### Authentication with the LCMAPS VOMS plugin\n \n-Please choose one of these and follow the instructions in one of the two following sections.\n+1.  Add the following line to `/etc/sysconfig/globus-gridftp-server`:\n \n-\u2014\\#\\#\\# Configuring Gridmap Support\n+        :::shell\n+        export LLGT_VOMS_ENABLE_CREDENTIAL_CHECK=1\n \n-<span class=\"twiki-macro STARTSECTION\">Gridmap</span> By default, GridFTP uses a gridmap file, found in `/etc/grid-security/grid-mapfile`. This file is not generated by default. There are two ways you can generate this file. You can generate this file manually, by including DN/username combinations. This is most useful for debugging. Otherwise, you can install edg-mkgridmap, which will periodically contact a list of VOMS servers that you specify. It assembles a list of users from those servers and creates a grid-mapfile. This grid-mapfile serves both as a list of authorized users and provides a mapping from user dns to local user ids.\n+    This should _only_ be done for OSG 3.3; it is unnecessary for OSG 3.4.\n \n-To install edg\\_mkgridmap, perform the following steps\n+2.  Follow the instructions in [the LCMAPS VOMS plugin installation and configuration document](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/InstallLcmapsVoms) to prepare the LCMAPS VOMS plugin.\n \n-``` rootscreen\n-yum install edg-mkgridmap\n-```\n+!!! note\n+    This is the suggested mechanism for all new installs.\n \n-Review `/etc/edg-mkgridmap.conf` to make sure that it has all VOs that you are interested in and also to comment out any VOs that you do not wish to support.\n+#### Authentication with edg-mkgridmap\n \n-``` rootscreen\n-vi /etc/edg-mkgridmap.conf\n-```\n+!!! warning\n+    As of the June 2017 release of OSG 3.4.0, this software is officially deprecated. Support is scheduled to end as of June 2018.\n \n-This utility `edg-mkgridmap` runs as a cronjob `/etc/cron.d/edg-mkgridmap-cron` (by default every 6 hours). You can also run `edg-mkgridmap` manually to see that it generates `/etc/grid-security/grid-mapfile`.\n+By default, GridFTP uses a gridmap file, found in `/etc/grid-security/grid-mapfile`. This is the file generated by `edg-mkgridmap` if you follow the default [install instructions](https://twiki.opensciencegrid.org/bin/view/Documentation/Release3/Edg-mkgridmap).  No further configuration is needed.\n \n-``` rootscreen\n-edg-mkgridmap\n-```\n+#### Authentication with GUMS\n \n-Then, you can enable/start the service.\n+!!! warning\n+    As of the June 2017 release of OSG 3.4.0, this software is officially deprecated. Support is scheduled to end as of June 2018.\n \n-``` rootscreen\n-/sbin/service edg-mkgridmap start\n-/sbin/chkconfig edg-mkgridmap on\n-```\n+If you want to use GUMS security (recommended), you will need to enable it using the following steps:\n \n-You can read more on this page: [edg\\_mkgridmap (on the CE)](Documentation/Release3.InstallComputeElement#5_2_Using_edg_mkgridmap_for_auth) <span class=\"twiki-macro ENDSECTION\">Gridmap</span>\n+1.  Edit `/etc/grid-security/gsi-authz.conf` and uncomment the globus callout.\n \n-\u2014\\#\\#\\# Configuring GUMS support\n+        :::text\n+        globus_mapping liblcas_lcmaps_gt4_mapping.so lcmaps_callout\n \n-<span class=\"twiki-macro STARTSECTION\">Gums</span> By default, GridFTP uses a gridmap file, found in `/etc/grid-security/gridmap-file`. If you want to use GUMS security (recommended), you will need to enable it using the following steps:\n+    Note that this used to be the full path to the library (`/usr/lib64` or `/usr/lib`), but now we rely on the linker for proper resolution in this file.\n \n-First, edit `/etc/grid-security/gsi-authz.conf` and uncomment the globus callout.\n+2.  Edit `/etc/lcmaps.db` to include your service endpoint:\n \n-``` file\n-globus_mapping liblcas_lcmaps_gt4_mapping.so lcmaps_callout\n-```\n+        :::text\n+        ...\n+        gumsclient = \"lcmaps_gums_client.mod\"\n+                     \"-resourcetype ce\"\n+                     \"-actiontype execute-now\"\n+                     \"-capath /etc/grid-security/certificates\"\n+                     \"-cert   /etc/grid-security/hostcert.pem\"\n+                     \"-key    /etc/grid-security/hostkey.pem\"\n+                     \"--cert-owner root\"\n+        # Change this URL to your GUMS server\n+                     \"--endpoint https://%RED%gums.example.com:8443%ENDCOLOR%/gums/services/GUMSXACMLAuthorizationServicePort\"", 
  "html_url": "https://github.com/opensciencegrid/docs/pull/24#discussion_r134534747", 
  "id": 134534747, 
  "in_reply_to_id": 134522164, 
  "original_commit_id": "15a0a4d19a92c444ca1f94db31db24517701dd4e", 
  "original_position": 191, 
  "path": "docs/storage/gridftp.md", 
  "position": 191, 
  "pull_request_review_id": 57837410, 
  "pull_request_url": "https://api.github.com/repos/opensciencegrid/docs/pulls/24", 
  "updated_at": "2017-08-22T16:33:20Z", 
  "url": "https://api.github.com/repos/opensciencegrid/docs/pulls/comments/134534747", 
  "user": {
    "avatar_url": "https://avatars0.githubusercontent.com/u/5246893?v=4", 
    "events_url": "https://api.github.com/users/matyasselmeci/events{/privacy}", 
    "followers_url": "https://api.github.com/users/matyasselmeci/followers", 
    "following_url": "https://api.github.com/users/matyasselmeci/following{/other_user}", 
    "gists_url": "https://api.github.com/users/matyasselmeci/gists{/gist_id}", 
    "gravatar_id": "", 
    "html_url": "https://github.com/matyasselmeci", 
    "id": 5246893, 
    "login": "matyasselmeci", 
    "organizations_url": "https://api.github.com/users/matyasselmeci/orgs", 
    "received_events_url": "https://api.github.com/users/matyasselmeci/received_events", 
    "repos_url": "https://api.github.com/users/matyasselmeci/repos", 
    "site_admin": false, 
    "starred_url": "https://api.github.com/users/matyasselmeci/starred{/owner}{/repo}", 
    "subscriptions_url": "https://api.github.com/users/matyasselmeci/subscriptions", 
    "type": "User", 
    "url": "https://api.github.com/users/matyasselmeci"
  }
}
